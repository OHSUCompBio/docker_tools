<tool id="evai_poster" name="eVai Sample Poster" version="1.0.0">
	<description>Uploads VCFs to eVai to analyze</description>
	<requirements>
	</requirements>
	<command><![CDATA[
	#if $ped.selector == "family"
		sed -i "s/.*reference=/\#\#reference=hg19/g" ${dragen_variants} &&
		sed -i "s/.*reference=/\#\#reference=hg19/g" ${ped.father_vcf} &&
		sed -i "s/.*reference=/\#\#reference=hg19/g" ${ped.mother_vcf} &&
		ln -s ${ped.pedigree} family.ped &&
		ln -s ${dragen_variants} sample.vcf &&
		ln -s ${ped.father_vcf} father.vcf &&
		ln -s ${ped.mother_vcf} mother.vcf &&
		java -jar \${EVAI_JAR_PATH}/eVaiAnalysisExecutor_2.0.0.jar analyze --vcf -f sample.vcf -f father.vcf -f mother.vcf -n ${sample_id} -pd family.ped -tk "`cat ${token_file}`" > ${output_log}
	#else
		sed -i "s/.*reference=/\#\#reference=hg19/g" ${dragen_variants} &&
		ln -s ${dragen_variants} sample.vcf &&
		java -jar \${EVAI_JAR_PATH}/eVaiAnalysisExecutor_2.0.0.jar analyze --vcf -f sample.vcf -n ${sample_id} -tk "`cat ${token_file}`" > ${output_log}
	#end if
	]]>
	</command>
	<inputs>
		<param name="sample_id" type="text" label="Sample ID"/>
		<param name="token_file" type="data" label="eNgenome token"/>
		<param name="dragen_variants" type="data" format="vcf" label="DRAGEN VCF"/>
		<conditional name="ped">
            <param name="selector" type="select" label="Select to launch family analysis">
                <option value="individual" selected="True">Individual</option>
                <option value="family" selected="True">Family</option>
            </param>
            <when value="family">
                 <param type="data" name="pedigree" label="Pedigree file" format="tabular"/>
				 <param name="father_vcf" type="data" format="vcf" label="Father VCF"/>
				 <param name="mother_vcf" type="data" format="vcf" label="Mother VCF"/>
            </when>
			<when value="no">
        	</when>
		</conditional>
	</inputs>

	<outputs>
		<data name="output_log" format="txt" label="log: txt"/>
	</outputs>

	<help></help>
</tool>

